<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualise differential distribution between countries • learningtower</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visualise differential distribution between countries">
<meta property="og:description" content="learningtower">
<meta property="og:image" content="https://ropenscilabs.github.io/learningtower/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">learningtower</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/exploring_time.html">Exploring temporal trends</a>
    </li>
    <li>
      <a href="../articles/visualise_distribution.html">Visualise differential distribution between countries</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Visualise differential distribution between countries</h1>
                        <h4 class="author">Vignette Author</h4>
            
            <h4 class="date">2020-06-05</h4>
      
      
      <div class="hidden name"><code>visualise_distribution.Rmd</code></div>

    </div>

    
    
<div id="some-prelimworking-thoughts" class="section level1">
<h1 class="hasAnchor">
<a href="#some-prelimworking-thoughts" class="anchor"></a>Some prelim/working thoughts…</h1>
<p>We put forward the possibility that (despite?) the apparent decreasing trend in the performance of Australian students in the PISA standardised testing, there are more nuiances in this data than simply a decrease in the average test scores.</p>
<p>One thing that we should be aware of is that there is a huge individual variability for each country.</p>
<p>We will attempt to answer these questions via the maths test score.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)</pre></body></html></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✔ ggplot2 3.3.1     ✔ purrr   0.3.4
## ✔ tibble  3.0.1     ✔ dplyr   1.0.0
## ✔ tidyr   1.1.0     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">learningtower</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggrepel</span>)

<span class="no">selected_countries</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"JPN"</span>, <span class="st">"AUS"</span>)
<span class="fu">theme_set</span>(<span class="fu">theme_classic</span>(<span class="fl">18</span>) +
            <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>))</pre></body></html></div>
</div>
<div id="check-for-dupes" class="section level1">
<h1 class="hasAnchor">
<a href="#check-for-dupes" class="anchor"></a>Check for dupes</h1>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">student</span>)
<span class="no">student</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">janitor</span><span class="kw ns">::</span><span class="fu">get_dupes</span>(<span class="no">country</span>, <span class="no">year</span>, <span class="no">school_id</span>, <span class="no">student_id</span>)</pre></body></html></div>
</div>
<div id="simplified-boxplot" class="section level1">
<h1 class="hasAnchor">
<a href="#simplified-boxplot" class="anchor"></a>Simplified boxplot</h1>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">selected_country_avg</span> <span class="kw">=</span> <span class="no">student</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">%in%</span> <span class="no">selected_countries</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">year</span>, <span class="no">country</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(
    <span class="kw">math_p25</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">math</span>, <span class="fl">0.25</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">math_p50</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">math</span>, <span class="fl">0.50</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
    <span class="kw">math_p75</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">math</span>, <span class="fl">0.75</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>))</pre></body></html></div>
<pre><code>## `summarise()` regrouping output by 'year' (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">student</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">%in%</span> <span class="no">selected_countries</span>, <span class="no">year</span> <span class="kw">==</span> <span class="fl">2003</span>)</pre></body></html></div>
<pre><code>## # A tibble: 17,258 x 22
##    year  country school_id student_id mother_educ father_educ gender computer
##    &lt;fct&gt; &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;      &lt;fct&gt;       &lt;fct&gt;       &lt;fct&gt;  &lt;fct&gt;   
##  1 2003  AUS     00001     00001      less than … ISCED 3A    male   no      
##  2 2003  AUS     00001     00002      ISCED 3A    ISCED 3A    male   yes     
##  3 2003  AUS     00001     00003      ISCED 3A    ISCED 2     female yes     
##  4 2003  AUS     00001     00004      ISCED 3B, C ISCED 3A    female yes     
##  5 2003  AUS     00001     00005      ISCED 3B, C ISCED 3B, C female yes     
##  6 2003  AUS     00001     00006      ISCED 3B, C ISCED 3A    male   yes     
##  7 2003  AUS     00001     00007      ISCED 3B, C ISCED 3B, C female yes     
##  8 2003  AUS     00001     00008      ISCED 2     ISCED 2     male   no      
##  9 2003  AUS     00001     00009      &lt;NA&gt;        &lt;NA&gt;        male   yes     
## 10 2003  AUS     00001     00010      less than … ISCED 3B, C female yes     
## # … with 17,248 more rows, and 14 more variables: internet &lt;fct&gt;, math &lt;dbl&gt;,
## #   read &lt;dbl&gt;, science &lt;dbl&gt;, stu_wgt &lt;dbl&gt;, desk &lt;fct&gt;, room &lt;fct&gt;,
## #   dishwasher &lt;fct&gt;, television &lt;fct&gt;, computer_n &lt;fct&gt;, car &lt;fct&gt;,
## #   book &lt;fct&gt;, wealth &lt;dbl&gt;, escs &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">selected_country_avg</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">year</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">math_p50</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">country</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">country</span>)) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">ymin</span> <span class="kw">=</span> <span class="no">math_p25</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">math_p75</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.2</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.7</span>) +
  <span class="fu">geom_point</span>(<span class="kw">size</span> <span class="kw">=</span> <span class="fl">3</span>) +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="kw">group</span> <span class="kw">=</span> <span class="no">country</span>)) +
  <span class="fu">scale_fill_brewer</span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Dark2"</span>) +
  <span class="fu">scale_colour_brewer</span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Dark2"</span>) +
  <span class="fu">labs</span>(<span class="kw">y</span> <span class="kw">=</span> <span class="st">"Math scores"</span>)</pre></body></html></div>
<p><img src="visualise_distribution_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>By the looks of the simplified boxplot above, there is indeed a large spread of test score. Focusing on the IQR (Q3 - Q1, represented by the shaded rectangles), the spread is about 150-200 scores, which is quite large. The overlaps of the middle 50% of students between JPN and AUS is also quite large.</p>
</div>
<div id="is-the-decreasing-trend-a-more-general-trend-around-the-world" class="section level1">
<h1 class="hasAnchor">
<a href="#is-the-decreasing-trend-a-more-general-trend-around-the-world" class="anchor"></a>Is the decreasing trend a more general trend around the world?</h1>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># quant_fns = function(x){</span>
<span class="co">#   q = quantile(x = x, probs = c(0.01, 0.05, 0.25, 0.50, 0.75, 0.95, 0.99), na.rm = TRUE)</span>
<span class="co">#   list(tibble(quant = names(q),</span>
<span class="co">#               values = q))</span>
<span class="co">#   }</span>
<span class="co"># </span>
<span class="co"># country_summ = student %&gt;% </span>
<span class="co">#   mutate(year = year - 2000) %&gt;% </span>
<span class="co">#   group_by(year, country) %&gt;% </span>
<span class="co">#   summarise(quant = quant_fns(math)) %&gt;% </span>
<span class="co">#   ungroup() %&gt;% </span>
<span class="co">#   unnest(quant)</span>

<span class="no">country_summ</span> <span class="kw">=</span> <span class="no">student</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">year</span> <span class="kw">=</span> <span class="no">year</span> <span class="kw">%&gt;%</span> <span class="no">as.character</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(),
    <span class="kw">year</span> <span class="kw">=</span> <span class="no">year</span> - <span class="fl">2000</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">year</span>, <span class="no">country</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="kw">math_p50</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">math</span>, <span class="fl">0.5</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()</pre></body></html></div>
<pre><code>## `summarise()` regrouping output by 'year' (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">country_lm</span> <span class="kw">=</span> <span class="no">country_summ</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">country</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu">n</span>() <span class="kw">==</span> <span class="fl">7</span>) <span class="kw">%&gt;%</span> <span class="co">## 7 survey years and 7 quantile values were calculated</span>
  <span class="fu">nest</span>() <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(
    <span class="kw">lm</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="kw">.x</span> <span class="kw">=</span> <span class="no">data</span>, ~ <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">math_p50</span> ~ <span class="no">year</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">.x</span>)),
    <span class="kw">lm_tidy</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">lm</span>, <span class="kw pkg">broom</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">country</span>, <span class="no">lm_tidy</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">lm_tidy</span>) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(<span class="no">country</span>, <span class="no">term</span>, <span class="no">estimate</span>, <span class="no">p.value</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">term</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">term</span> <span class="kw">==</span> <span class="st">"(Intercept)"</span>, <span class="st">"int"</span>, <span class="no">term</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"estimate"</span>, <span class="st">"p.value"</span>),
               <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">"names"</span>,
               <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"values"</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_wider</span>(<span class="kw">names_from</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"term"</span>, <span class="st">"names"</span>),
              <span class="kw">values_from</span> <span class="kw">=</span> <span class="st">"values"</span>)


<span class="no">country_lm</span> <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">int_estimate</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">year_estimate</span>,
             <span class="kw">size</span> <span class="kw">=</span> -<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="no">year_p.value</span>),
             <span class="kw">label</span> <span class="kw">=</span> <span class="no">country</span>)) +
  <span class="fu">geom_point</span>() +
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span>() +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">"Median score in the year 2000"</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Avg decrease in median score every year since 2000"</span>,
       <span class="kw">size</span> <span class="kw">=</span> <span class="st">"-log10(p-value of slope)"</span>)</pre></body></html></div>
<p><img src="visualise_distribution_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Some explanation: + Only countries who participated in all 7 surveys are included. + Due to centering of the years, the x-axis is the median score for the year 2000. + The y-axis is the avg decrease in the median score per year since 2000. + The size of point/label indicates the statistical significance of the avg decrease. + If a country had a good education performance in the year 2000, then it often leaves much little room to improve. In fact, almost every country with a median score past 500 tends to have a worse education performance over the years. + Countries that has a low performance in the year 2000 tend to improve their scores rather than decrease.</p>
</div>
<div id="is-meanmedian-the-best-summary-of-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#is-meanmedian-the-best-summary-of-the-data" class="anchor"></a>Is mean/median the best summary of the data?</h1>
<p>I can agree that there is a huge variability in the individual test scores, so maybe more complex modelling (?linear mixed models?) could help??</p>
<p>But just because there is a large variability in the data, I don’t think it is completely meaningless to compare across countries. Sure, the original Conversation article produced figures that zoomed into the averaged data, which might exaggerated the decreasing trends, but the solution isn’t to resetting zoom to the whole range of the raw data. Because the average of many values (X-bar) will have a smaller spread than Xi’s.</p>
<p>I put forward the argument that we should consider visualising the raw scores without any summarisation. This might be achived through ECDF. Each bump in the ECDF curve is a raw data point. So instead of trying to come up with a summarisation of location or spread, we can see the entire sample distribution of marks for each country. This way we can see the entire distribution of scores in a country and compare the distribution rather than comparing a simple one number summary and be lured into making false conclusions.</p>
<p>Using the simulation from Gaussian distribution below, we can see that a difference in mean can be characterised by a horizontal shift (because the red curve is <strong>right</strong> of the green, it thus has a <strong>higher</strong> mean than green) and a small sd is characterised by a sharp increase in the middle of the curve.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">123</span>)

<span class="fu">bind_rows</span>(
  <span class="fu">tibble</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1000</span>, <span class="fl">0</span>, <span class="fl">1</span>),
         <span class="kw">y</span> <span class="kw">=</span> <span class="st">"small mean, small sd"</span>) ,
  <span class="fu">tibble</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1000</span>, <span class="fl">0</span>, <span class="fl">10</span>),
         <span class="kw">y</span> <span class="kw">=</span> <span class="st">"small mean, large sd"</span>),
  <span class="fu">tibble</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">1000</span>, <span class="fl">5</span>, <span class="fl">1</span>),
         <span class="kw">y</span> <span class="kw">=</span> <span class="st">"large mean, small sd"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">y</span>)) +
  <span class="fu">stat_ecdf</span>(<span class="kw">geom</span> <span class="kw">=</span> <span class="st">"step"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.2</span>) +
  <span class="fu">scale_colour_brewer</span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Set1"</span>)</pre></body></html></div>
<p><img src="visualise_distribution_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>We compute the ECDF/EPDF of four selected countries below.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">student</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AUS"</span>, <span class="st">"USA"</span>, <span class="st">"JPN"</span>, <span class="st">"BRA"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">math</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">country</span>)) +
  <span class="fu">geom_density</span>() +
  <span class="fu">facet_wrap</span>(~<span class="no">year</span>) +
  <span class="fu">scale_colour_brewer</span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Set1"</span>)</pre></body></html></div>
<pre><code>## Warning: Removed 6414 rows containing non-finite values (stat_density).</code></pre>
<p><img src="visualise_distribution_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">student</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"AUS"</span>, <span class="st">"USA"</span>, <span class="st">"JPN"</span>, <span class="st">"BRA"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">math</span>, <span class="kw">colour</span> <span class="kw">=</span> <span class="no">country</span>)) +
  <span class="fu">stat_ecdf</span>(<span class="kw">geom</span> <span class="kw">=</span> <span class="st">"step"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1.2</span>) +
  <span class="fu">facet_wrap</span>(~<span class="no">year</span>) +
  <span class="fu">scale_colour_brewer</span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Set1"</span>)</pre></body></html></div>
<pre><code>## Warning: Removed 6414 rows containing non-finite values (stat_ecdf).</code></pre>
<p><img src="visualise_distribution_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>Interesting findings: + In most cases, AUS, USA and JPN share quite similar gradient of ECDF, which might be an indication that they have similar spread. BRA tends to have a bit of sharper increase. So that could imply some advantages in favour of the top students. + If the argument is that an average student in JPN does better than an average student in AUS, then we can now refine this statement to use a precise statement using quantiles and distributions. E.g. a student who stores in the top 50% of JPN student population is able to score better than 66.5% of AUS student population. But of course, this gao narrows when you go towards the top of the distributions.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">student</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">==</span> <span class="st">"JPN"</span>, <span class="no">year</span> <span class="kw">==</span> <span class="fl">2018</span>) <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">math</span>) <span class="kw">%&gt;%</span> <span class="no">median</span></pre></body></html></div>
<pre><code>## [1] 532.182</code></pre>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">student</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">==</span> <span class="st">"AUS"</span>, <span class="no">year</span> <span class="kw">==</span> <span class="fl">2018</span>) <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">math</span>) <span class="kw">&lt;=</span> <span class="fl">532.182</span>)</pre></body></html></div>
<pre><code>## [1] 0.6653121</code></pre>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">student</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">==</span> <span class="st">"JPN"</span>, <span class="no">year</span> <span class="kw">==</span> <span class="fl">2018</span>) <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">math</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="fl">0.90</span>)</pre></body></html></div>
<pre><code>##     90% 
## 636.917</code></pre>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">student</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">==</span> <span class="st">"AUS"</span>, <span class="no">year</span> <span class="kw">==</span> <span class="fl">2018</span>) <span class="kw">%&gt;%</span> <span class="fu">pull</span>(<span class="no">math</span>) <span class="kw">&lt;=</span> <span class="fl">636.9</span>)</pre></body></html></div>
<pre><code>## [1] 0.9445106</code></pre>
</div>
<div id="mixed-model" class="section level1">
<h1 class="hasAnchor">
<a href="#mixed-model" class="anchor"></a>Mixed model</h1>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lme4</span>)
<span class="no">aus_data</span> <span class="kw">=</span> <span class="no">student</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span> <span class="kw">==</span> <span class="st">"AUS"</span>)

<span class="co"># lm(math ~ escs + gender, data = aus_data) %&gt;% summary</span>

<span class="no">obj</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html">lmer</a></span>(<span class="no">math</span> ~ <span class="no">escs</span> + <span class="no">gender</span> + (<span class="no">escs</span> + <span class="no">gender</span><span class="kw">|</span><span class="no">year</span>/<span class="no">school_id</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">aus_data</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">obj</span>)
<span class="co"># plot(obj)</span>
<span class="co"># qqnorm(residuals(obj))</span></pre></body></html></div>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</pre></body></html></div>
<pre><code>## R version 4.0.0 (2020-04-24)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.5
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] ggrepel_0.8.2            broom_0.5.6              learningtower_0.0.0.9000
##  [4] forcats_0.5.0            stringr_1.4.0            dplyr_1.0.0             
##  [7] purrr_0.3.4              readr_1.3.1              tidyr_1.1.0             
## [10] tibble_3.0.1             ggplot2_3.3.1            tidyverse_1.3.0         
## 
## loaded via a namespace (and not attached):
##  [1] tidyselect_1.1.0   xfun_0.14          haven_2.3.1        lattice_0.20-41   
##  [5] colorspace_1.4-1   vctrs_0.3.0        generics_0.0.2     htmltools_0.4.0   
##  [9] yaml_2.2.1         utf8_1.1.4         blob_1.2.1         rlang_0.4.6       
## [13] pkgdown_1.5.1.9000 pillar_1.4.4       withr_2.2.0        glue_1.4.1        
## [17] DBI_1.1.0          RColorBrewer_1.1-2 dbplyr_1.4.4       modelr_0.1.8      
## [21] readxl_1.3.1       lifecycle_0.2.0    munsell_0.5.0      gtable_0.3.0      
## [25] cellranger_1.1.0   rvest_0.3.5        memoise_1.1.0      evaluate_0.14     
## [29] labeling_0.3       knitr_1.28         fansi_0.4.1        Rcpp_1.0.4.6      
## [33] backports_1.1.7    scales_1.1.1       desc_1.2.0         jsonlite_1.6.1    
## [37] farver_2.0.3       fs_1.4.1           hms_0.5.3          digest_0.6.25     
## [41] stringi_1.4.6      grid_4.0.0         rprojroot_1.3-2    cli_2.0.2         
## [45] tools_4.0.0        magrittr_1.5       crayon_1.3.4       pkgconfig_2.0.3   
## [49] MASS_7.3-51.5      ellipsis_0.3.1     xml2_1.3.2         reprex_0.3.0      
## [53] lubridate_1.7.8    assertthat_0.2.1   rmarkdown_2.2      httr_1.4.1        
## [57] rstudioapi_0.11    R6_2.4.1           nlme_3.1-147       compiler_4.0.0</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kim Fitter, Paul Yacobellis, Erika Siregar, Sarah Romanes, Kevin Wang, Giulio Valentino Dalla Riva, Dianne Cook, Nick Tierney.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
